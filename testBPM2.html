<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="test2.css" rel="stylesheet" type="text/css" media="all">
    <meta http-equiv="refresh" content="1;index.html">
    <title>Network-Speed-Based Metronome</title>
</head>
<body>
    <img src="img/piano_A.png" alt="">
    <audio id="metronome" src="Metronom.mp3"></audio>

    <script>
        // ネットワーク速度を取得する関数
        async function getNetworkSpeed() {
            const startTime = Date.now();
            await fetch('https://example.com/dummy-file.jpg'); // 例: 1MBのダミーファイル
            const endTime = Date.now();

            const duration = (endTime - startTime) / 1000; // 秒
            const fileSizeInBits = 1000000 * 8; // 1MB（8ビット）を想定
            const speedBps = fileSizeInBits / duration;
            return speedBps / 1000000; // Mbps単位
        }

        // BPMを設定する関数（ネットワーク速度に応じて変化）
        async function setBPM() {
            const speed = await getNetworkSpeed();
            const baseBPM = 60; // 最低BPM
            const bpm = baseBPM + Math.floor(speed); // 回線速度に応じたBPM
            return bpm;
        }

        // BPMに基づいてメトロノーム音を再生
        async function playMetronome() {
            const bpm = await setBPM();
            const interval = 60000 / bpm; // BPMをミリ秒間隔に変換
            const audio = document.getElementById("metronome");

            setInterval(() => {
                audio.currentTime = 0; // 音をリセット
                audio.play();
            }, interval);
        }

        playMetronome();
    </script>
</body>
</html>
